---
layout: post
title: Pentesting Redis Servers
date: 2015-09-17 16:43:37.000000000 -04:00
type: post
published: true
status: publish
categories:
- Code
- Pentest
tags:
- python
- Redis
meta:
  _rest_api_published: '1'
  _rest_api_client_id: '-1'
  _publicize_job_id: '14893763018'
  _wpas_linkedin_publicize_failure: |-
    O:13:"Keyring_Error":2:{s:6:"errors";a:1:{s:21:"keyring-request-error";a:1:{i:0;a:5:{s:7:"headers";a:11:{s:6:"server";s:17:"Apache-Coyote/1.1";s:15:"x-li-request-id";s:10:"7HUNTZGRO2";s:4:"date";s:29:"Thu, 17 Sep 2015 20:43:41 GMT";s:4:"vary";s:1:"*";s:11:"x-li-format";s:4:"json";s:12:"content-type";s:30:"application/json;charset=UTF-8";s:16:"content-encoding";s:4:"gzip";s:11:"x-li-fabric";s:9:"prod-ltx1";s:8:"x-li-pop";s:9:"prod-ltx1";s:9:"x-li-uuid";s:24:"viDer67eBBSwaltjGCsAAA==";s:10:"set-cookie";s:154:"lidc="b=TB39:g=198:u=37:i=1442522622:t=1442609022:s=AQHVVSsBqYNKgrgPzrOAueFoA14Tp5EQ"; Expires=Fri, 18 Sep 2015 20:43:42 GMT; domain=.linkedin.com; Path=/";}s:4:"body";s:139:"{
      "errorCode": 0,
      "message": "[unauthorized]. restricted",
      "requestId": "7HUNTZGRO2",
      "status": 401,
      "timestamp": 1442522622611
    }";s:8:"response";a:2:{s:4:"code";i:401;s:7:"message";s:12:"Unauthorized";}s:7:"cookies";a:1:{i:0;O:14:"WP_Http_Cookie":5:{s:4:"name";s:4:"lidc";s:5:"value";s:80:""b=TB39:g=198:u=37:i=1442522622:t=1442609022:s=AQHVVSsBqYNKgrgPzrOAueFoA14Tp5EQ"";s:7:"expires";i:1442609022;s:4:"path";s:1:"/";s:6:"domain";s:13:".linkedin.com";}}s:8:"filename";N;}}}s:10:"error_data";a:0:{}}
  _publicize_failed_869255: |-
    O:13:"Keyring_Error":2:{s:6:"errors";a:1:{s:21:"keyring-request-error";a:1:{i:0;a:5:{s:7:"headers";a:11:{s:6:"server";s:17:"Apache-Coyote/1.1";s:15:"x-li-request-id";s:10:"7HUNTZGRO2";s:4:"date";s:29:"Thu, 17 Sep 2015 20:43:41 GMT";s:4:"vary";s:1:"*";s:11:"x-li-format";s:4:"json";s:12:"content-type";s:30:"application/json;charset=UTF-8";s:16:"content-encoding";s:4:"gzip";s:11:"x-li-fabric";s:9:"prod-ltx1";s:8:"x-li-pop";s:9:"prod-ltx1";s:9:"x-li-uuid";s:24:"viDer67eBBSwaltjGCsAAA==";s:10:"set-cookie";s:154:"lidc="b=TB39:g=198:u=37:i=1442522622:t=1442609022:s=AQHVVSsBqYNKgrgPzrOAueFoA14Tp5EQ"; Expires=Fri, 18 Sep 2015 20:43:42 GMT; domain=.linkedin.com; Path=/";}s:4:"body";s:139:"{
      "errorCode": 0,
      "message": "[unauthorized]. restricted",
      "requestId": "7HUNTZGRO2",
      "status": 401,
      "timestamp": 1442522622611
    }";s:8:"response";a:2:{s:4:"code";i:401;s:7:"message";s:12:"Unauthorized";}s:7:"cookies";a:1:{i:0;O:14:"WP_Http_Cookie":5:{s:4:"name";s:4:"lidc";s:5:"value";s:80:""b=TB39:g=198:u=37:i=1442522622:t=1442609022:s=AQHVVSsBqYNKgrgPzrOAueFoA14Tp5EQ"";s:7:"expires";i:1442609022;s:4:"path";s:1:"/";s:6:"domain";s:13:".linkedin.com";}}s:8:"filename";N;}}}s:10:"error_data";a:0:{}}
  _publicize_done_external: a:1:{s:7:"twitter";a:1:{i:648456;s:59:"https://twitter.com/averagesecguy/status/644612717580435456";}}
  _publicize_done_869256: '1'
  _wpas_done_648456: '1'
  publicize_twitter_user: averagesecguy
author:
  login: averagesecurityguy
  email: stephen@averagesecurityguy.info
  display_name: averagesecurityguy
  first_name: ''
  last_name: ''
---
<p>Redis is an in-memory key/value data store used to handle backend data for many web applications. Often, Redis is used to store configuration information, session information, and user profile information. By default the Redis server does not require authentication for client access. This is not a problem if Redis is only listening on localhost but often it is not.</p>
<h3>Finding Redis Servers</h3>
<p>By default Redis listens on port 6379, which is not in the Nmap top 1000 port list or the /etc/services list used by Nessus. You will need to scan specifically for this service if you want to find it.<br />
<h3>Interacting with Redis</h3>
<p>The easiest way to interact with Redis is to use the Redis CLI client, redis-cli. On Kali2 you can install the client by installing the redis-tools package with apt-get. After installing redis-cli you can connect to the Redis server using <code>redis-cli -h &lt;hostname&gt; -p &lt;port&gt;</code>.</p>
<p>Once connected you can use the following commands to gather data from the server:</p>
<ul>
<li><code>info</code> - Outputs server data including version, number of databases, and the number of keys in each database.</li>
<li><code>select &lt;n&gt;</code> - Select a database to work with. By default Redis has 16 databases available, 0 - 15. Typically, only 0 is used.</li>
<li><code>keys &lt;pattern&gt;</code> - Display all keys matching the regex pattern. To see all keys use *.</li>
<li><code>type &lt;key&gt;</code> - Displays the type of the value stored in the key, string, hash, set.</li>
<li><code>get &lt;key&gt;</code> - Print the value of the string key.</li>
<li><code>hgetall &lt;key&gt;</code> - Get all of the field/value pairs stored in the hash key.</li>
<li><code>hget &lt;field&gt; &lt;key&gt;</code> - Get the value of the specified field in the hash key.</li>
</ul>
<p>The full list of supported commands can be found here: <a href="http://redis.io/commands">http://redis.io/commands</a>. This list is all of the commands supported in the latest version of Redis. Some of the commands may not work in older versions.</p>
<p>In addition to redis-cli, you can also access a Redis server using a number of programming languages. A full list of Redis clients by language is available here: <a href="http://redis.io/clients">http://redis.io/clients</a>.</p>
<h3>Simple Python Example</h3>
<p>To use the example script below you will need to install the redis-py library using <code>pip install redis</code>. If Pip is not installed you can install it on Kali using <code>apt-get install python-pip</code>.</p>
<pre>
import redis
db = redis.StrictRedis(host='127.0.0.1', port=6379)

# If we have a hash key, print all of the fields and values.
for key in db.keys():
    if db.type(key) == ‘hash’:
        r = db.hgetall(key)
        print('--------')
        for k in r:
            print('Field: {0} Value: {1}'.format(k, r['k']))
        print('--------')
</pre>
<h3>Update</h3>
<p>If you come across a Redis server that is password protected, there is an <a href="https://nmap.org/nsedoc/scripts/redis-brute.html">NSE script</a> that can be used to brute force the password. Once you find the password you can connect to the server using <code>redis-cli -h &lt;host&gt; -p &lt;port&gt; -a &lt;password&gt;</code>.</p>
<h3>Update 2015/09/18</h3>
<p>Thanks <a href="https://twitter.com/bonsaiviking" target="_blank">@bonsaiviking</a> for pointing out the redis-info NSE script. So if you are hunting specifically for Redis servers you can use something like this:</p>
<p><code>nmap -p 6379 --script=redis-info 127.0.0.1 --open</code></p>
<p>Which should yield results like this:</p>
<pre>
Starting Nmap 6.49BETA4 ( https://nmap.org ) at 2015-09-18 12:02 EDT
Nmap scan report for localhost (127.0.0.1)
Host is up (0.000062s latency).
PORT     STATE SERVICE
6379/tcp open  unknown
| redis-info: 
|   Version            2.8.17
|   Operating System   Linux 4.0.0-kali1-amd64 x86_64
|   Architecture       64 bits
|   Process ID         8020
|   Used CPU (sys)     0.04
|   Used CPU (user)    0.06
|   Connected clients  1
|   Connected slaves   0
|   Used memory        491.84K
|_  Role               master

Nmap done: 1 IP address (1 host up) scanned in 0.45 seconds
</pre>
<p>You can also scan for Redis servers using Metasploit with the <a href="http://www.rapid7.com/db/modules/auxiliary/scanner/misc/redis_server" target="_blank">auxiliary/scanner/misc/redis_server</a>.</p></p>
