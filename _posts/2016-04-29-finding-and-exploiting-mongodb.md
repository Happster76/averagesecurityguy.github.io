---
layout: post
title: Finding and Exploiting MongoDB
---

MongoDB is a NoSQL database used to handle backend data for many web applications. Often, MongoDB is used to store configuration information, session information, and user profile information. By default the MongoDB does not require authentication for client access. This is not a problem if MongoDB is only listening on localhost but often it is not.

**Finding MongoDB Servers
By default MongoDB listens on port 27017, which is not in the Nmap top 1000 port list or the /etc/services list used by Nessus. You will need to scan specifically for this service if you want to find it.

Although MongoDB does not have authentication enabled by default it can be enabled. Nessus, Metasploit , and Nmap have methods to identify MongoDB servers that are not using authentication.

**Manual Interaction with MongoDB
The easiest way to interact with MongoDB is to use the Mongo CLI client, mongo. On Kali2 you can install the client by installing the mongodb-clients package with apt-get. After installing mongodb-clients you can connect to the MongoDB server using:

    mongo [hostname]:[port]/[database_name]. 

The local database holds information about the server while the admin database holds any credentials stored on the server.

Once connected you can use the following commands to gather data from the server:

* `show databases` – Shows all of the databases on the server.
* `use` – Uses the specified database name
* `show collections` – Shows a list of collections (similar to tables) in the database.
* `db.findOne()` – Displays the first entry in the collection. All collection entries are JSON objects.
* `db.find()` – Displays a list of entries in the collection.
* `it` – Iterates through the list returned by find().

More information about using the mongo shell can be found here: https://docs.mongodb.org/getting-started/shell.

**Scripted Interaction with MongoDB
One of the nice things about the mongo shell is we can write JavaScript files and have them executed on the server. So if there is a particular set of information you would like to find you can write a script to gather that data for you.

To run a script specify the script file on the as part of the mongo command to connect to the server:

    mongo [hostname]:[port]/[database_name] [script_name]

**Example Script to Gather Mongo Server Info
Download the [access.js](https://github.com/averagesecurityguy/scripts/blob/master/access.js) script run it against the "local" database on the MongoDB server. We need to specify the "local" database because that is where the startup_log collection is stored.

If you have a list of IP addresses that you want to gather information about, you can use a simple bash one-liner along with the access.js script to gather the data.

    for i in $(ip_list); do echo $i; mongo $i/local access.js; done;

**Example Script to Gather Mongo Credentials
In some cases the MongoDB server may be configured to allow users to access it both with credentials and anonymously. In this case it may be possible to access the server anonymously and gather the plaintext or hashed credentials from the admin database. The [creds.js](https://github.com/averagesecurityguy/scripts/blob/master/creds.js) script will gather MONGODB-CR and SCRAM-SHA-1 hashes from the "admin" database on the MongoDB server if they exist.

As of April, 2016, oclHashcat could not crack either form of password hash. You can use the MongoDB password cracking scripts, which are available [here](https://github.com/averagesecurityguy/scripts/blob/master/mongodb_cr_crack.py) and [here](https://github.com/averagesecurityguy/scripts/blob/master/mongoscram.go) to crack these passwords.

**Fixing the Problem
MongoDB can be configured to require authentication for all user accounts and as of Mongo3.0 it supports a strong hashing algorithm, SCRAM-SHA-1. I highly recommend enabling authentication for all users and using the SCRAM-SHA-1 hashing algorithm with strong passphrases.

https://docs.mongodb.org/manual/tutorial/enable-authentication/
https://docs.mongodb.org/manual/release-notes/3.0-scram/
